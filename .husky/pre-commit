#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Git ì €ì¥ì†Œì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì°¾ê¸°
ROOT_DIR=$(git rev-parse --show-toplevel)

# gradlewì— ëŒ€í•œ ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš©
GRADLEW="$ROOT_DIR/gradlew"

echo 'ğŸ” Running pre-commit checks...'
$GRADLEW spotlessApply

# ë³€ê²½ëœ íŒŒì¼ì´ ìˆë‹¤ë©´ ìë™ ì¶”ê°€
git add .

$GRADLEW clean build -x test --scan

if [ $? -ne 0 ]; then
  echo "âŒ Pre-commit checks failed. Fix the errors before committing."
  exit 1
fi

echo "ğŸ” Checkstyle ê²€ì‚¬ ì‹¤í–‰ ì¤‘..."
$GRADLEW checkstyleMain
if [ $? -ne 0 ]; then
  echo "âŒ Checkstyle ê·œì¹™ ìœ„ë°˜! ì»¤ë°‹ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤."
  exit 1
fi

echo "âœ… ëª¨ë“  ê²€ì‚¬ í†µê³¼! ì»¤ë°‹ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."